
epicsEnvSet("MASTER_ID", "0")

require ecmccfg v9.5.5_RC1,"ENG_MODE=1,ECMC_VER=v9.5.5_RC1"
require ecmccomp
require ecmc_master_slave sandst_a

#- #################################################################
# only print error messages
asynSetTraceMask(${ECMC_ASYN_PORT}, -1, 0x01)


##############################################################################
# - apply hardware configuration
${SCRIPTEXEC} ${ecmccfg_DIR}loadSubstConfig.cmd,  "FILE=cfg/hw.subst"

# Set all slave 9 outputs to feed switches
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput01,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput02,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput03,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput04,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput05,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput06,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput07,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput08,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput09,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput10,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput11,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput12,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput13,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput14,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput15,1)"
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(14,binaryOutput16,1)"

##############################################################################
# - load motor configuration
epicsEnvSet("DEV", "X10SA-ES1-VFM")
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax1_TRYUW.yaml, DRV_SLAVE=015, ENC_SLAVE=005, ENC_CHANNEL=01"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=015"

${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax2_TRYR.yaml,  DRV_SLAVE=016, ENC_SLAVE=005, ENC_CHANNEL=02"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=016"

${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax3_TRYDW.yaml, DRV_SLAVE=017, ENC_SLAVE=008, ENC_CHANNEL=01"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=017"

epicsEnvSet("DEV", "X10SA-ES1-HFM")
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax4_TRYUR.yaml, DRV_SLAVE=018, ENC_SLAVE=008, ENC_CHANNEL=02"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=018"

${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax5_TRYW.yaml,  DRV_SLAVE=019, ENC_SLAVE=007, ENC_CHANNEL=01"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=019"

${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax6_TRYDR.yaml, DRV_SLAVE=020, ENC_SLAVE=007, ENC_CHANNEL=02"
$(SCRIPTEXEC) ${ECMC_CONFIG_ROOT}loadYamlEnc.cmd,      "FILE=cfg/enc_openloop_Y.yaml, DRV_SLAVE=020"

# virtual axes
epicsEnvSet("DEV", "X10SA-ES1-VFM")
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax7_TRX.yaml"
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax8_TRY.yaml"
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax9_PITCH.yaml"
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax10_ROLL.yaml"
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd,     "FILE=cfg/ax11_YAW.yaml"

# load the VFM virtual axes PLC
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadPLCFile.cmd, "FILE=cfg/VFM.plc,PLC_ID=1,INC=.:${ecmc_master_slave_DIR},PLC_MACROS='PLC_ID=1,AX_Y1=1,AX_Y2=2,AX_Y3=3,AX_X1=4,AX_X2=5,AX_TRX=7,AX_TRY=8,AX_PITCH=9,AX_ROLL=10,AX_YAW=11,GRP_ID_SA=${GRP_VFM_REAL_ID=0},GRP_ID_MA=${GRP_VFM_VIRT_ID=0}'"

#- #############################################################################
#- Temporary test
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}loadYamlAxis.cmd, "FILE=cfg/ax_Servo_angle.yaml, DRV_SLAVE=021"

#- #################################################################
#- apply the configuration
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}applyConfig.cmd


#- #################################################################
#- go active
${SCRIPTEXEC} ${ECMC_CONFIG_ROOT}setAppMode.cmd

require "calc"
require "opticaltable","wang_x1"
# The following lines were generated by "ioc install"
# Generated at: 2024-09-10 09:38:28.853780

cd "/ioc/X10SA-CPCL-ES1"
dbLoadTemplate("X10SA-CPCL-ES1_mirrors.subs")

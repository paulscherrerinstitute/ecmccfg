#General
epicsEnvSet("ECMC_MOTOR_NAME",            "${AX_NAME}")
epicsEnvSet("ECMC_R",                     "${AX_NAME}-")
epicsEnvSet("ECMC_AXIS_NO",               "${AX_ID}")
epicsEnvSet("ECMC_DESC",                  "${AX_DESC}")
epicsEnvSet("ECMC_EGU",                   "${AX_EGU}")                        # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                         # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                          # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                          # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "${AX_MOD}")                         # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_AX_MOD)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                         # For positioning and ECMC_MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance

#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM" ,        "-${AX_MOD}")
epicsEnvSet("ECMC_ENC_SCALE_DENOM",       "12800")
epicsEnvSet("ECMC_ENC_TYPE",              "0")                         # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS",              "16")                        # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "0")                         # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "0")                         # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.positionActual01")          # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "")      # Error 0: SSI input error
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "")      # Error 1: SSI frame error
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "")      # Error 2: Encoder power fail
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)

#Drive
epicsEnvSet("ECMC_DRV_TYPE",              "0")                         # Stepper: 0. DS402: 1 (DS402 = servos and advanced stepper drives)
ecmcEpicsEnvSetCalc("ECMC_DRV_SCALE_NUM" , "-${AX_MOD}*10", "%lf")
epicsEnvSet("ECMC_DRV_SCALE_DENOM"        "32768.0")                   # I/O range for ECMC_EC_ALIAS_DRV_VELO_SET
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveControl01.0")      # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveStatus01.1")       # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.velocitySetpoint01")  # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveControl01.2")      # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "")                          # Ethercat entry for brake output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "0")                    # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "0")                    # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_EC_DRV_RESET",          "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveControl01.1")      # Reset
epicsEnvSet("ECMC_EC_DRV_ALARM_0",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveStatus01.3")       # Error
epicsEnvSet("ECMC_EC_DRV_ALARM_1",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveStatus01.7")       # Stall
epicsEnvSet("ECMC_EC_DRV_ALARM_2",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveStatus01.14")      # Sync error
epicsEnvSet("ECMC_EC_DRV_WARNING",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.driveStatus01.2")       # Warning

#Trajectory
ecmcEpicsEnvSetCalc("ECMC_VELO",              "${AX_MOD}/20", "%lf")
ecmcEpicsEnvSetCalc("ECMC_JOG_VEL",           "${AX_MOD}/20", "%lf")
epicsEnvSet("ECMC_JAR",                   "0.0")                       #JAR defaults to VELO/ACCL
ecmcEpicsEnvSetCalc("ECMC_ACCS_EGU_PER_S2",   "${AX_MOD}/100", "%lf")
ecmcEpicsEnvSetCalc("ECMC_EMERG_DECEL",       "${AX_MOD}/100", "%lf")

#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing

#Controller
epicsEnvSet("ECMC_CNTRL_KP",              "15.0")
epicsEnvSet("ECMC_CNTRL_KI",              "0.02")
epicsEnvSet("ECMC_CNTRL_KD",              "0.0")
epicsEnvSet("ECMC_CNTRL_KFF",             "1.0")

#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.ONE.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.ONE.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.ONE.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s${ECMC_EC_SLAVE_NUM_DRIVE}.ONE.0")              #  Ethercat entry for external interlock input

# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "0")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "0")
epicsEnvSet("ECMC_DXLM_ENABLE",           "0")

# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "2")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "200")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "1")

# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.1")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",     "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")

# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "500.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
